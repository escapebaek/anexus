{% extends 'base.html' %}
{% block page_content %}
<div class="container mt-5">
  <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
    <h1 class="section-title mb-0">My Results</h1>
    <div>
      <a href="{% url 'analytics_overview' %}" class="btn btn-outline-info me-2">
        <i class="fas fa-chart-bar"></i> Overall Analytics
      </a>
      <a href="{% url 'question_home' %}" class="btn btn-primary">
        <i class="fas fa-arrow-left"></i> Back to Home
      </a>
    </div>
  </div>

  {% if results %}
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="thead-dark">
        <tr>
          <th>Title</th>
          <th>Date</th>
          <th>Score</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for r in results %}
        <tr>
          <td>{{ r.title }}</td>
          <td>{{ r.date_taken }}</td>
          <td>{{ r.score_text }}</td>
          <td>
            <a href="{% url 'exam_results' %}?result_id={{ r.id }}" class="btn btn-sm btn-outline-primary">
              <i class="fas fa-eye"></i> View
            </a>
            <a href="{% url 'result_analytics' r.id %}" class="btn btn-sm btn-outline-success">
              <i class="fas fa-chart-bar"></i> Attempt Analytics
            </a>
            {% if r.is_exam and r.exam_id %}
            <a href="{% url 'exam_analytics' r.exam_id %}" class="btn btn-sm btn-outline-secondary">
              Rollup
            </a>
            {% endif %}
            <form method="post" action="{% url 'delete_result' r.id %}" style="display:inline" onsubmit="return confirm('정말 이 결과를 삭제하시겠습니까? 삭제 시 통계에서 제외됩니다.');">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-danger">
                <i class="fas fa-trash"></i> Delete
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="text-center py-5 text-muted">
    <i class="fas fa-history fa-3x mb-3"></i>
    <div>No results yet. Take an exam to get started.</div>
  </div>
  {% endif %}
</div>
{% endblock %}

